{% load verbatim %}
{% verbatim %}

<div>
	<ul class="nav nav-tabs">
		<li ng-class="{active: urlTab == 'bm'}"><a href="#/status/{{urlStatus}}/tab/bm/bm/">AI-BM</a></li>
		<li ng-class="{active: urlTab == 'id'}"><a href="#/status/{{urlStatus}}/tab/id/id/">AI-ID</a></li>
		<li ng-class="{active: urlTab == 'logic'}"><a href="#/status/{{urlStatus}}/tab/logic/logic/">Logic</a></li>
	</ul>
</div>

<br />

<div class="alert" ng-class="{'alert-success': alert.success, 'alert-danger': !alert.success}" ng-show="alert.show">
	<button type="button" class="close" ng-click="closeAlert()">&times;</button>
	<strong>{{alert.title}}</strong> {{alert.body}}
</div>

<div class="table-responsive id-table">
	<table class="table table-bordered table-hover table-condensed">
		<tr>
			<th colspan="4"></th>
			<th colspan="6">NSLS II Active Interlock Envelope (AIE)</th>
			<th colspan="35">AI EPS & Logic for e-beam within the phase space of AIE-ID (dumped otherwise)</th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th colspan="2">Radiation source</th>
			<th></th>
			<th colspan="6">AIE-ID</th>
			<th colspan="3"></th>
			<th colspan="4">BPM-ID1 (s1)</th>
			<th rowspan="3">Logic</th>
			<th colspan="4">BPM-ID2 (s2)</th>
			<th colspan="5">E-beam (s3)</th>
			<th colspan="3"></th>
			<th colspan="4">BPM-ID1 (s1)</th>
			<th rowspan="3">Logic</th>
			<th colspan="4">BPM-ID2 (s2)</th>
			<th colspan="5">E-beam (s3)</th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th colspan="2"></th>
			<th></th>
			<th colspan="3"></th>
			<th colspan="2">Lattice</th>
			<th></th>
			<th colspan="3"></th>
			<th colspan="4">Down-stream of Str. Sect.</th>
			<th colspan="4">Up-stream of Str. Sect.</th>
			<th colspan="5">AIE location</th>
			<th colspan="3"></th>
			<th colspan="4">Down-stream of Str. Sect.</th>
			<th colspan="4">Up-stream of Str. Sect.</th>
			<th colspan="5">AIE location</th>
			<th></th>
			<th></th>
		</tr>
		<tr>
			<th>Cell</th>
			<th>Type</th>
			<th>Set</th>
			<th>Str. sect.</th>
			<th>AIE Name</th>
			<th>Shape</th>
			<th>Defined by</th>
			<th>Name</th>
			<th>Position (s)</th>
			<th>Pos. from cent. Str. Sect.</th>
			
			<th>Max. offset</th>
			<th>Max. angle</th>
			<th>Extra offset</th>
			<th>Lattice name</th>
			<th>Lattice position (s1)</th>
			<th>Position from AIE-ID location</th>
			<th>Offset (AIOLH)</th>
			<th>Lattice name</th>
			<th>Lattice position (s2)</th>
			<th>Position from AIE-ID location</th>
			<th>Offset (AIOLH)</th>
			<th>Lattice position (s3)</th>
			<th>Pos. from cent. Str. Sect.</th>
			<th>Offset (AIOLH)</th>
			<th>Logic</th>
			<th>Angle (AIALH)</th>
			
			<th>Max. offset</th>
			<th>Max. angle</th>
			<th>Extra offset</th>
			<th>Lattice name</th>
			<th>Lattice position (s1)</th>
			<th>Position from AIE-ID location</th>
			<th>Offset (AIOLV)</th>
			<th>Lattice name</th>
			<th>Lattice position (s2)</th>
			<th>Position from AIE-ID location</th>
			<th>Offset (AIOLV)</th>
			<th>Lattice position (s3)</th>
			<th>Pos. from cent. Str. Sect.</th>
			<th>Offset (AIOLV)</th>
			<th>Logic</th>
			<th>Angle (AIOLV)</th>
			<th>Safe current</th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th>m</th>
			<th>m</th>
			
			<th>mm</th>
			<th>mrad</th>
			<th></th>
			<th></th>
			<th>m</th>
			<th>m</th>
			<th>mm</th>
			<th></th>
			<th></th>
			<th>m</th>
			<th>m</th>
			<th>mm</th>
			<th>m</th>
			<th>m</th>
			<th>mm</th>
			<th></th>
			<th>mrad</th>

			<th>mm</th>
			<th>mrad</th>
			<th></th>
			<th></th>
			<th>m</th>
			<th>m</th>
			<th>mm</th>
			<th></th>
			<th></th>
			<th>m</th>
			<th>m</th>
			<th>mm</th>
			<th>m</th>
			<th>m</th>
			<th>mm</th>
			<th></th>
			<th>mrad</th>
			<th>mA</th>
			<th></th>
		</tr>
		<tr>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th>|x1|&lt;</th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th>|x2|&lt;</th>
			<th></th>
			<th></th>
			<th>|x1+(x2-x1)*(s3-s1)/(s2-s1)|&lt;</th>
			<th></th>
			<th>|(x2-x1)/(s2-s1)|&lt;</th>

			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th>|y1|&lt;</th>
			<th></th>
			<th></th>
			<th></th>
			<th></th>
			<th>|y2|&lt;</th>
			<th></th>
			<th></th>
			<th>|y1+(y2-y1)*(s3-s1)/(s2-s1)|&lt;</th>
			<th></th>
			<th>|(y2-y1)/(s2-s1)|&lt;</th>
			<th></th>
			<th></th>
		</tr>
		
		<!--Editable-->
		{% endverbatim %}
		{% if user.is_authenticated %}
		<tr ng-if="urlStatus == 'editable'" ng-repeat="id in idArr">
		{% else %}
		<tr ng-if="false" ng-repeat="id in idArr">
		{% endif %}
		{% verbatim %}

			<td ng-repeat="prop in id.save_display" ng-class="{'danger': id.prop_statuses[prop] && id.prop_statuses[prop] == 2}">
				<span ng-if="prop != 'shape'" class="edit-wrapper">
					<a ng-if="prop != 'logic' && prop != 'name'" href="#" onbeforesave="updateItem(id, prop, $data)" class="edit" editable-text="id[prop]">{{id[prop] || '&nbsp;'}}</a>
					<a ng-if="prop == 'name'" href="#" onbeforesave="updateItemFixed(id, prop, $data)" class="edit" editable-text="id[prop]">{{id[prop] || '&nbsp;'}}</a>
					<a ng-if="prop == 'logic'" href="#" onbeforesave="updateItemFixed(id, prop, $data)" class="edit select" editable-select="id[prop]" e-ng-options="name for name in logicArr">{{id[prop] || '&nbsp;'}}</a>
				</span>
				<span ng-if="prop == 'shape'">
					{{id[prop] || '&nbsp;'}}
				</span>
				<button ng-click="approveCell(id, prop)" ng-if="id.prop_statuses[prop] && id.prop_statuses[prop] == 2" class="btn btn-sm btn-default" style=""><i style="color: #a94442;" class="glyphicon glyphicon-check glyphicon-white"></i></button>
			</td>
			<td>
				<button ng-click="approveRow(id)" class="btn btn-default" ng-class="{'btn-danger': id.prop_statuses.num_unapproved > 0, 'btn-default': id.prop_statuses.num_unapproved == 0}">Approve</button>
				<button ng-click="addRow(id)" class="btn btn-default">Copy&Create</button>
			</td>
		</tr>

		<!--Not editable-->
		{% endverbatim %}
		{% if user.is_authenticated %}
		<tr ng-if="urlStatus != 'editable'" ng-repeat="id in idArr">
		{% else %}
		<tr ng-if="true" ng-repeat="id in idArr">
		{% endif %}
		{% verbatim %}

			<td ng-repeat="prop in id.save_display">
				{{id[prop] || '&nbsp;'}}
			</td>
			<td>
			</td>
		</tr>
		
		<tr ng-if="newInsD">
			<td ng-repeat="prop in newInsD.save_display" ng-class="{'danger': newInsD.approvable[prop] == true}">
				<span class="form-group" ng-class="{'has-error': error[prop]}">
					<input ng-if="prop != 'logic'" type="text" ng-model="newInsD[prop]" ng-disabled="prop == 'bm_type'" class="form-control input-sm" />
					<select ng-if="prop == 'logic'" ng-options="name for name in logicArr" type="text" ng-model="newInsD[prop]" class="form-control input-sm select"></select>
				</span>
			</td>
			<td>
				<button ng-click="saveItem(newInsD)" class="btn btn-warning">Add</button>
				<button ng-click="cancel()" class="btn btn-default">Cancel</button>
			</td>
		</tr>

		{% endverbatim %}
		{% if user.is_authenticated %}
		<tr ng-if="urlStatus == 'editable'">
		{% else %}
		<tr ng-if="false">
		{% endif %}
		{% verbatim %}

			<td colspan="46"><button ng-click="addRow()" class="btn btn-info"><i class="glyphicon glyphicon-plus"></i> Add new data</button></td>
		</tr>
	</table>
</div>

{% endverbatim %}